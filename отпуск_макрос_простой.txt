Attribute VB_Name = "Module1"
' ОЧЕНЬ ПРОСТОЙ МАКРОС ДЛЯ ОТПУСКОВ
' ТОЛЬКО БАЗОВЫЕ КОМАНДЫ

Sub ОбновитьГрафик()
    ' Простое сообщение - проверка что макрос работает
    MsgBox "Макрос запущен! Сейчас обновлю график.", vbInformation
    
    ' Получаем листы
    Dim листДанные As Worksheet
    Dim листГрафик As Worksheet
    
    Set листДанные = ThisWorkbook.Worksheets("ДАННЫЕ")
    Set листГрафик = ThisWorkbook.Worksheets("ГРАФИК")
    
    ' Очищаем старые данные в графике (столбцы C-L)
    листГрафик.Range("C4:L10").ClearContents
    листГрафик.Range("C4:L10").Interior.ColorIndex = xlNone
    
    ' Цвет для отпуска
    Dim цветОтпуска As Long
    цветОтпуска = RGB(200, 255, 200) ' Светло-зеленый
    
    ' Обрабатываем каждого сотрудника
    Dim строка As Integer
    For строка = 2 To 4 ' Только первые 3 сотрудника
        ' Получаем даты
        Dim датаНачало As Date
        Dim датаКонец As Date
        
        On Error Resume Next ' Игнорируем ошибки дат
        датаНачало = листДанные.Cells(строка, 3).Value
        датаКонец = листДанные.Cells(строка, 4).Value
        On Error GoTo 0
        
        ' Если даты валидны
        If IsDate(датаНачало) And IsDate(датаКонец) Then
            ' Рассчитываем дни
            Dim дниОтпуска As Integer
            дниОтпуска = датаКонец - датаНачало + 1
            листДанные.Cells(строка, 5).Value = дниОтпуска
            
            ' Отмечаем отпуск в графике (только для января)
            If Month(датаНачало) = 1 And Month(датаКонец) = 1 Then
                Dim день As Integer
                For день = Day(датаНачало) To Day(датаКонец)
                    If день <= 10 Then ' Только первые 10 дней
                        Dim столбец As Integer
                        столбец = день + 2 ' C=3 соответствует дню 1
                        
                        With листГрафик.Cells(строка + 1, столбец)
                            .Value = "О"
                            .Interior.Color = цветОтпуска
                            .Font.Bold = True
                            .HorizontalAlignment = xlCenter
                        End With
                    End If
                Next день
            End If
        Else
            ' Очищаем поле дней если даты невалидны
            листДанные.Cells(строка, 5).ClearContents
        End If
    Next строка
    
    ' Подгоняем ширину столбцов
    листГрафик.Columns.AutoFit
    
    ' Сообщение об успехе
    MsgBox "График обновлен успешно!", vbInformation
End Sub

' Еще более простая тестовая процедура
Sub Тест()
    MsgBox "Тестовый макрос работает!", vbInformation
End Sub
